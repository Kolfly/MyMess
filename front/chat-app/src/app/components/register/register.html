<div class="register-container">
  <mat-card class="register-card">
    <mat-card-header class="register-header">
      <mat-card-title>
        <div class="title-container">
          <mat-icon class="app-icon">chat</mat-icon>
          <h1>MyMess</h1>
        </div>
      </mat-card-title>
      <mat-card-subtitle>
        Créez votre compte pour commencer à discuter
      </mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="register-content">
      <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
        <!-- Nom d'utilisateur -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Nom d'utilisateur</mat-label>
          <input 
            matInput 
            formControlName="username"
            placeholder="Votre nom d'utilisateur"
            maxlength="20"
            required>
          <mat-icon matSuffix>account_circle</mat-icon>
          @if (registerForm.get('username')?.invalid && registerForm.get('username')?.touched) {
            <mat-error>{{ getUsernameErrorMessage() }}</mat-error>
          }
        </mat-form-field>

        <!-- Email -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Adresse email</mat-label>
          <input 
            matInput 
            formControlName="email"
            type="email"
            placeholder="votre@email.com"
            required>
          <mat-icon matSuffix>email</mat-icon>
          @if (registerForm.get('email')?.invalid && registerForm.get('email')?.touched) {
            <mat-error>{{ getEmailErrorMessage() }}</mat-error>
          }
        </mat-form-field>

        <!-- Prénom et Nom (optionnels) -->
        <div class="name-row">
          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Prénom (optionnel)</mat-label>
            <input 
              matInput 
              formControlName="firstName"
              placeholder="Votre prénom"
              maxlength="50">
            <mat-icon matSuffix>person</mat-icon>
            @if (registerForm.get('firstName')?.invalid && registerForm.get('firstName')?.touched) {
              <mat-error>{{ getFirstNameErrorMessage() }}</mat-error>
            }
          </mat-form-field>

          <mat-form-field appearance="outline" class="half-width">
            <mat-label>Nom (optionnel)</mat-label>
            <input 
              matInput 
              formControlName="lastName"
              placeholder="Votre nom"
              maxlength="50">
            <mat-icon matSuffix>person_outline</mat-icon>
            @if (registerForm.get('lastName')?.invalid && registerForm.get('lastName')?.touched) {
              <mat-error>{{ getLastNameErrorMessage() }}</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Mot de passe -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Mot de passe</mat-label>
          <input 
            matInput 
            formControlName="password"
            [type]="hidePassword ? 'password' : 'text'"
            placeholder="Votre mot de passe"
            required>
          <button 
            type="button" 
            mat-icon-button 
            matSuffix 
            (click)="hidePassword = !hidePassword">
            <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (registerForm.get('password')?.invalid && registerForm.get('password')?.touched) {
            <mat-error>{{ getPasswordErrorMessage() }}</mat-error>
          }
          <mat-hint>Au moins 6 caractères avec 1 majuscule, 1 minuscule et 1 chiffre</mat-hint>
        </mat-form-field>

        <!-- Confirmation mot de passe -->
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Confirmer le mot de passe</mat-label>
          <input 
            matInput 
            formControlName="confirmPassword"
            [type]="hideConfirmPassword ? 'password' : 'text'"
            placeholder="Confirmez votre mot de passe"
            required>
          <button 
            type="button" 
            mat-icon-button 
            matSuffix 
            (click)="hideConfirmPassword = !hideConfirmPassword">
            <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
          @if (registerForm.get('confirmPassword')?.invalid && registerForm.get('confirmPassword')?.touched) {
            <mat-error>{{ getConfirmPasswordErrorMessage() }}</mat-error>
          }
        </mat-form-field>

        <!-- Acceptation des conditions -->
        <div class="terms-container">
          <mat-checkbox formControlName="acceptTerms" required>
            J'accepte les <a href="#" target="_blank">conditions d'utilisation</a> 
            et la <a href="#" target="_blank">politique de confidentialité</a>
          </mat-checkbox>
          @if (registerForm.get('acceptTerms')?.invalid && registerForm.get('acceptTerms')?.touched) {
            <mat-error class="terms-error">
              Vous devez accepter les conditions pour continuer
            </mat-error>
          }
        </div>

        <!-- Bouton d'inscription -->
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          class="register-button full-width"
          [disabled]="registerForm.invalid || isLoading">
          
          @if (isLoading) {
            <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
            <span>Création du compte...</span>
          } @else {
            <ng-container>
              <mat-icon>person_add</mat-icon>
              <span>Créer mon compte</span>
            </ng-container>
          }
        </button>

        <!-- Lien vers connexion -->
        <div class="login-link">
          <p>
            Vous avez déjà un compte ? 
            <button 
              type="button" 
              mat-button 
              color="primary" 
              (click)="goToLogin()"
              class="link-button">
              Se connecter
            </button>
          </p>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Informations supplémentaires -->
  <div class="additional-info">
    <mat-card class="info-card">
      <mat-card-content>
        <div class="features">
          <div class="feature">
            <mat-icon>chat_bubble</mat-icon>
            <span>Messagerie instantanée</span>
          </div>
          <div class="feature">
            <mat-icon>group</mat-icon>
            <span>Discussions de groupe</span>
          </div>
          <div class="feature">
            <mat-icon>security</mat-icon>
            <span>Sécurisé et privé</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>